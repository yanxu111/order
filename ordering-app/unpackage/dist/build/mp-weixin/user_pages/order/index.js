(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["user_pages/order/index"],{"0419":function(e,t,r){"use strict";var n=r("4733"),a=r.n(n);a.a},"0f2b":function(e,t,r){"use strict";r.r(t);var n=r("2e0b"),a=r.n(n);for(var o in n)"default"!==o&&function(e){r.d(t,e,(function(){return n[e]}))}(o);t["default"]=a.a},"2b61":function(e,t,r){"use strict";var n;r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return o})),r.d(t,"a",(function(){return n}));var a=function(){var e=this,t=e.$createElement;e._self._c},o=[]},"2e0b":function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o(r("a34a")),a=r("26cb");function o(e){return e&&e.__esModule?e:{default:e}}function c(e,t,r,n,a,o,c){try{var i=e[o](c),s=i.value}catch(u){return void r(u)}i.done?t(s):Promise.resolve(s).then(n,a)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){c(o,n,a,i,s,"next",e)}function s(e){c(o,n,a,i,s,"throw",e)}i(void 0)}))}}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){d(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var f={name:"order-index",data:function(){return{branch_shop_name:"",table_code:"",isDisablePack:!1,remarks:""}},onLoad:function(e){this.branch_shop_id=e.branch_shop_id?e.branch_shop_id:"",this.table_code=e.table_code?e.table_code:"",this.getShopArea({branch_shop_id:this.branch_shop_id,table_code:this.table_code}),this.isDisablePack=!!this.table_code,this.isPack=!1},methods:u(u(u({},(0,a.mapActions)({getShopArea:"business/getShopArea",submitOrder:"order/submitOrder",wechatPayOrder:"order/wechatPayOrder",getShopInfo:"business/getShopInfo"})),(0,a.mapMutations)({SET_TABLE_CODE:"cart/SET_TABLE_CODE"})),{},{chackedPack:function(e){this.isPack=e.target.value,this.SET_TABLE_CODE({isTableCode:e.target.value})},gopay:function(){var t=this,r={branch_shop_id:this.branch_shop_id,table_code:this.table_code,remarks:this.remarks,is_pack:this.isPack?"1":"0",distribution_type:this.table_code?"0":"2"};this.submitOrder({orderData:r,completed:function(){var r=i(n.default.mark((function r(a){var o,c,i;return n.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(200!==a.code){r.next=13;break}if(a.data.true_total!==t.total){r.next=10;break}return o=a.data.true_total,c=a.data.ordernum,r.next=6,t.wechatPayOrder({notify_url:t.$config.baseApi+"/api/home/wxpay/wechat_notify",ordernum:c,price:o});case 6:i=r.sent,200===i.code?e.requestPayment({provider:"wxpay",timeStamp:String(i.timeStamp),nonceStr:i.nonceStr,package:i.package,signType:"MD5",paySign:i.paySign,success:function(r){e.showToast({title:"支付成功",icon:"success",duration:2e3,success:function(){setTimeout((function(){e.navigateTo({url:"/user_pages/order/pay_success?branch_shop_id=".concat(t.branch_shop_id,"&table_code=").concat(t.table_code)})}),2e3)}})},fail:function(r){e.showToast({title:"支付成功",icon:"success",duration:2e3,success:function(){setTimeout((function(){e.navigateTo({url:"/user_pages/order/pay_success?branch_shop_id=".concat(t.branch_shop_id,"&table_code=").concat(t.table_code)})}),2e3)}})}}):e.showToast({title:"请求支付失败",icon:"error",duration:2e3}),r.next=11;break;case 10:e.showToast({title:"当前金额存在异议，请重新进入程序点餐",icon:"error",duration:2e3});case 11:r.next=14;break;case 13:e.showToast({title:a.data,icon:"error",duration:2e3});case 14:case"end":return r.stop()}}),r)})));function a(e){return r.apply(this,arguments)}return a}()})}}),computed:u(u({},(0,a.mapState)({shopArea:function(e){return e.business.shopArea},cartData:function(e){return e.cart.cartData},isTableCode:function(e){return e.cart.isTableCode},shopInfo:function(e){return e.business.shopInfo}})),(0,a.mapGetters)({total:"cart/total",packTotal:"cart/packTotal"}))};t.default=f}).call(this,r("543d")["default"])},4733:function(e,t,r){},"508d":function(e,t,r){"use strict";(function(e){r("b225");n(r("66fd"));var t=n(r("9c39"));function n(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=r,e(t.default)}).call(this,r("543d")["createPage"])},"9c39":function(e,t,r){"use strict";r.r(t);var n=r("2b61"),a=r("0f2b");for(var o in a)"default"!==o&&function(e){r.d(t,e,(function(){return a[e]}))}(o);r("0419");var c,i=r("f0c5"),s=Object(i["a"])(a["default"],n["b"],n["c"],!1,null,"32b8888c",null,!1,n["a"],c);t["default"]=s.exports}},[["508d","common/runtime","common/vendor"]]]);